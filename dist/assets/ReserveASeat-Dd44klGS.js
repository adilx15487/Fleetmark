import{c as z,r as c,N as F,j as e,O as H,B as y,i as D,k as u,T as M,Q as W,V as _,W as E,u as q,n as Q,F as V,H as X,t as O,Y as G,P as J,o as L,X as K}from"./index-BOVp0MNk.js";import{C as k}from"./check-BlTPTqQ1.js";/**
 * @license lucide-react v0.574.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}]],ee=z("ban",Z),se=({onComplete:N})=>{const[o,v]=c.useState(1),[l,i]=c.useState(""),[x,R]=c.useState(""),[b,f]=c.useState(null),[j,n]=c.useState(!1),w=c.useMemo(()=>{if(!l)return F;const t=l.toLowerCase();return F.filter(r=>r.toLowerCase().includes(t))},[l]),S=t=>{R(t);const r=E(t);r.length===1?(f(r[0]),n(!1),v(2)):r.length===2&&(n(!0),f(null))},C=t=>{f(t),n(!1),v(2)},$=()=>{x&&b&&N(x,b)},m=b?H[b]:null;return e.jsx("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-primary-900 via-primary-800 to-primary-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-accent-400 text-primary-900 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-accent-400/30",children:e.jsx(y,{className:"w-8 h-8"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Welcome to Fleetmark! ðŸšŒ"}),e.jsx("p",{className:"text-primary-300 mt-2 text-sm sm:text-base",children:"Before your first reservation, tell us where you live."}),e.jsx("p",{className:"text-primary-400 text-xs mt-1",children:"We'll assign you to the right bus automatically every time."})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-6",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${o>=1?"bg-accent-400 text-primary-900":"bg-white/10 text-white/50"}`,children:o>1?e.jsx(k,{className:"w-4 h-4"}):"1"}),e.jsx("div",{className:`w-12 h-0.5 ${o>1?"bg-accent-400":"bg-white/10"}`}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all ${o===2?"bg-accent-400 text-primary-900":"bg-white/10 text-white/50"}`,children:"2"})]}),o===1&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-2xl",children:[e.jsx("h3",{className:"text-sm font-bold text-primary-900 mb-1",children:"Your drop-off point"}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"This is where the bus will drop you off every night."}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(D,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search stopsâ€¦",value:l,onChange:t=>i(t.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 text-sm focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 outline-none placeholder:text-slate-300"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-xl border border-slate-200 divide-y divide-slate-100",children:[w.map(t=>{const r=x===t,h=_(t);return e.jsxs("button",{onClick:()=>S(t),className:`w-full flex items-center gap-3 px-4 py-3 text-left transition-all ${r?"bg-primary-50 border-l-4 border-l-primary-500":"hover:bg-slate-50 border-l-4 border-l-transparent"}`,children:[e.jsx(u,{className:`w-4 h-4 shrink-0 ${r?"text-primary-600":"text-slate-300"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:`text-sm font-medium ${r?"text-primary-900":"text-slate-700"}`,children:t}),h&&e.jsx("span",{className:"ml-2 text-[10px] text-amber-500 font-semibold",children:"Both routes"})]}),r&&e.jsx(k,{className:"w-4 h-4 text-primary-600 shrink-0"})]},t)}),w.length===0&&e.jsxs("div",{className:"px-4 py-8 text-center text-sm text-slate-300",children:['No stops matching "',l,'"']})]}),j&&x&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-amber-50 border border-amber-200",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx(M,{className:"w-4 h-4 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:x})," is served by both buses. Please select your direction:"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["Bus 1","Bus 2"].map(t=>{const r=H[t];return e.jsxs("button",{onClick:()=>C(t),className:"p-3 rounded-xl border border-slate-200 bg-white hover:border-primary-300 hover:shadow-sm transition-all text-left",children:[e.jsx("p",{className:"text-sm font-bold text-primary-900",children:r.busNumber}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:r.routeName}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1 truncate",children:[r.stops[0]," â†’ ",r.stops[r.stops.length-1]]})]},t)})})]})]}),o===2&&m&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-2xl",children:[e.jsx("button",{onClick:()=>v(1),className:"text-xs text-slate-400 hover:text-primary-600 mb-4 transition-colors",children:"â† Change stop"}),e.jsx("h3",{className:"text-sm font-bold text-primary-900 mb-1",children:"Based on your stop, you'll be on:"}),e.jsxs("div",{className:"mt-4 p-5 rounded-2xl bg-gradient-to-br from-primary-50 to-primary-100/50 border border-primary-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary-600 text-white flex items-center justify-center shadow-lg shadow-primary-600/20",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-primary-900",children:m.busName}),e.jsx("p",{className:"text-xs text-primary-500",children:m.routeName})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-[10px] font-semibold text-slate-500 uppercase tracking-wider mb-2",children:"Route stops"}),e.jsx("div",{className:"flex overflow-x-auto gap-0 pb-2",style:{scrollbarWidth:"thin"},children:e.jsx("div",{className:"flex items-start gap-0 min-w-max",children:m.stops.map((t,r)=>{const h=t===x;return e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex flex-col items-center",style:{width:"66px"},children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-[8px] font-bold text-white shadow-sm ${h?"bg-emerald-500 ring-2 ring-emerald-300 ring-offset-1":r===0?"bg-primary-500":"bg-primary-300"}`,children:h?e.jsx(k,{className:"w-3 h-3"}):r+1}),e.jsx("p",{className:`text-[9px] text-center mt-1 leading-tight px-0.5 max-w-[62px] ${h?"font-bold text-emerald-700":"text-slate-500"}`,children:t})]}),r<m.stops.length-1&&e.jsx("div",{className:"flex items-center mt-[9px]",children:e.jsx("div",{className:"w-4 h-[2px] bg-primary-200"})})]},r)})})})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3 p-3 rounded-xl bg-emerald-50 border border-emerald-200",children:[e.jsx(u,{className:"w-4 h-4 text-emerald-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-400",children:"Your Stop"}),e.jsx("p",{className:"text-sm font-bold text-emerald-800",children:x})]})]}),e.jsxs("button",{onClick:$,className:"w-full mt-5 px-5 py-3.5 rounded-xl bg-emerald-500 text-white text-sm font-bold hover:bg-emerald-600 shadow-lg shadow-emerald-500/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2",children:["Confirm & Continue",e.jsx(W,{className:"w-4 h-4"})]})]})]})})},le=()=>{const{toast:N}=q(),{config:o,generatedSlots:v,serviceStatus:l}=Q(),{transport:i,isOnboarded:x,setHomeStop:R,tonightReservations:b,reservationsUsed:f,maxReservations:j,canReserve:n,makeReservation:w,isSlotReserved:S,isSlotOpen:C,getTimeUntilOpen:$,getBusInfo:m}=V(),[t,r]=c.useState(null),[,h]=c.useState(0);c.useEffect(()=>{const s=setInterval(()=>h(d=>d+1),1e3);return()=>clearInterval(s)},[]);const g=m(),Y=c.useCallback(()=>{!t||!n||(w(t.time,t.label),N(`âœ… Reserved! Bus departs at ${t.label}`),r(null))},[t,n,w,N]),P=c.useCallback(s=>{if(s.status==="stopped")return{kind:"break"};if(S(s.time))return{kind:"reserved"};const d=new Date,a=d.getHours()*60+d.getMinutes(),[p,I]=s.time.split(":").map(Number);let T=p*60+I;T<360&&a>=1080&&(T+=1440);const U=a<360?a+1440:a;return T<U-5?{kind:"passed"}:s.availableSeats===0?{kind:"full"}:C(s.time)?{kind:"open"}:{kind:"locked",opensIn:$(s.time)}},[S,C,$]),A=s=>{if(s<=0)return"Now!";const d=Math.floor(s/3600),a=Math.floor(s%3600/60),p=s%60;return d>0?`${d}h ${a}m`:a>0?`${a}m ${p}s`:`${p}s`};if(!x)return e.jsx(se,{onComplete:(s,d)=>{R(s,d),N("ðŸŽ‰ Setup complete! You can now reserve trips.")}});const B=b.filter(s=>s.status==="Confirmed");return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-700 via-primary-800 to-primary-900 rounded-2xl p-5 sm:p-6 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-56 h-56 bg-accent-400/10 rounded-full -translate-y-1/3 translate-x-1/3"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center shrink-0",children:e.jsx(y,{className:"w-5 h-5 text-accent-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-primary-300 uppercase tracking-wider",children:"Your Bus"}),e.jsx("p",{className:"text-sm font-bold",children:(g==null?void 0:g.busName)||"â€”"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center shrink-0",children:e.jsx(u,{className:"w-5 h-5 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-primary-300 uppercase tracking-wider",children:"Your Stop"}),e.jsx("p",{className:"text-sm font-bold",children:(i==null?void 0:i.homeStop)||"â€”"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center shrink-0",children:e.jsx(X,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-primary-300 uppercase tracking-wider",children:"Tonight"}),e.jsxs("p",{className:"text-sm font-bold",children:[f," / ",j," reserved"]})]})]})]})})]}),f===j-1&&n&&e.jsxs("div",{className:"flex items-center gap-2.5 px-4 py-3 rounded-xl bg-amber-50 border border-amber-200",children:[e.jsx(M,{className:"w-4 h-4 text-amber-500 shrink-0"}),e.jsx("p",{className:"text-xs text-amber-700 font-medium",children:"âš ï¸ 1 reservation remaining tonight."})]}),!n&&e.jsxs("div",{className:"flex items-center gap-2.5 px-4 py-3 rounded-xl bg-red-50 border border-red-200",children:[e.jsx(ee,{className:"w-4 h-4 text-red-500 shrink-0"}),e.jsxs("p",{className:"text-xs text-red-700 font-medium",children:["ðŸš« You've reached your limit for tonight. Resets tomorrow at ",O(o.operatingHours.startTime),"."]})]}),e.jsx("div",{className:`rounded-xl px-4 py-3 border ${l.state==="running"?"bg-emerald-50 border-emerald-200":l.state==="break"?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.state==="running"?"bg-emerald-500 animate-pulse":l.state==="break"?"bg-amber-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs font-semibold text-slate-700",children:l.state==="running"?`Buses running â€” Next at ${l.nextDeparture}`:l.state==="break"?`Break â€” Resumes at ${l.resumesAt}`:`Offline â€” Resumes at ${l.resumesAt}`})]}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:[O(o.operatingHours.startTime)," â€” ",O(o.operatingHours.endTime)]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-primary-900 mb-3",children:"Choose Your Trip"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:v.map((s,d)=>{const a=P(s),p=a.kind==="open"&&n;return e.jsxs("button",{disabled:!p,onClick:()=>p&&r(s),className:`relative rounded-2xl border p-4 text-left transition-all ${a.kind==="open"&&n?"bg-white border-emerald-300 hover:border-emerald-400 hover:shadow-lg hover:shadow-emerald-100/50 cursor-pointer ring-1 ring-emerald-100":a.kind==="reserved"?"bg-emerald-50 border-emerald-200 cursor-default":a.kind==="break"?"bg-amber-50/50 border-amber-200 cursor-not-allowed opacity-60":a.kind==="passed"?"bg-slate-50 border-slate-200 cursor-not-allowed opacity-40":a.kind==="full"?"bg-red-50 border-red-200 cursor-not-allowed opacity-60":"bg-white border-slate-200 cursor-not-allowed"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:`text-lg font-bold ${a.kind==="open"?"text-primary-900":a.kind==="reserved"?"text-emerald-800":a.kind==="passed"?"text-slate-400":"text-slate-600"}`,children:s.label}),a.kind==="open"&&n&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-emerald-100 text-emerald-700",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),"Reserve Now"]}),a.kind==="open"&&!n&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-600",children:"Limit reached"}),a.kind==="locked"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-slate-100 text-slate-500",children:[e.jsx(G,{className:"w-3 h-3"}),"Opens in ",A(a.opensIn)]}),a.kind==="break"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-amber-100 text-amber-600",children:[e.jsx(J,{className:"w-3 h-3"}),"Break"]}),a.kind==="reserved"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-emerald-200 text-emerald-800",children:[e.jsx(k,{className:"w-3 h-3"}),"Reserved"]}),a.kind==="passed"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-slate-100 text-slate-400",children:"Passed"}),a.kind==="full"&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-500",children:"Full"})]}),a.kind!=="break"?e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(u,{className:"w-3 h-3 text-slate-400"}),e.jsxs("span",{children:["From: ",e.jsx("strong",{className:"text-primary-800",children:"1337 School"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(u,{className:"w-3 h-3 text-emerald-400"}),e.jsxs("span",{children:["To: ",e.jsx("strong",{className:"text-primary-800",children:i==null?void 0:i.homeStop})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(y,{className:"w-3 h-3 text-slate-400"}),e.jsxs("span",{children:[s.availableSeats," seats available"]})]})]}):e.jsx("p",{className:"text-xs text-amber-500",children:"Service paused during break period."})]},d)})})]}),B.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5",children:[e.jsxs("h3",{className:"text-sm font-bold text-primary-900 mb-3",children:["Tonight's Reservations (",B.length,"/",j,")"]}),e.jsx("div",{className:"w-full h-2 rounded-full bg-slate-100 mb-4",children:e.jsx("div",{className:"h-2 rounded-full bg-emerald-500 transition-all",style:{width:`${B.length/j*100}%`}})}),e.jsx("div",{className:"space-y-2",children:B.map(s=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 rounded-xl bg-emerald-50 border border-emerald-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-emerald-900",children:s.slotLabel}),e.jsxs("p",{className:"text-[10px] text-emerald-600",children:["1337 School â†’ ",s.homeStop]})]})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[10px] font-bold bg-emerald-200 text-emerald-800",children:[e.jsx(k,{className:"w-3 h-3"}),"Confirmed"]})]},s.id))})]}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-page-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-base font-bold text-primary-900",children:"Confirm your reservation?"}),e.jsx("button",{onClick:()=>r(null),className:"text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"space-y-3 text-sm",children:[{label:"Departure",value:`${t.label} tonight`,icon:L},{label:"From",value:"1337 School",icon:u},{label:"To",value:(i==null?void 0:i.homeStop)||"â€”",icon:u},{label:"Bus",value:(g==null?void 0:g.busName)||"â€”",icon:y}].map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx(s.icon,{className:"w-4 h-4 text-primary-500 shrink-0"}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-slate-400",children:s.label}),e.jsx("span",{className:"font-semibold text-primary-900 text-right",children:s.value})]})]},s.label))}),e.jsxs("div",{className:"flex gap-3 mt-5",children:[e.jsx("button",{onClick:()=>r(null),className:"flex-1 px-4 py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Y,className:"flex-1 px-4 py-3 rounded-xl bg-emerald-500 text-white text-sm font-bold hover:bg-emerald-600 shadow-lg shadow-emerald-500/20 transition-all active:scale-[0.98]",children:"Confirm"})]})]})})]})};export{le as default};
